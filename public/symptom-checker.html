<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anemia Detection & Malaria Symptom Assessment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f9f0 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .background-blobs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .blob1 {
            width: 200px;
            height: 200px;
            background: #2e7d32;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .blob2 {
            width: 150px;
            height: 150px;
            background: #4caf50;
            top: 60%;
            right: 10%;
            animation-delay: 2s;
        }

        .blob3 {
            width: 100px;
            height: 100px;
            background: #66bb6a;
            bottom: 20%;
            left: 50%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #81c784, #a5d6a7);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .content {
            padding: 30px;
        }

        /* Image Upload Section */
        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            animation: fadeInUp 0.5s ease forwards;
        }

        .upload-title {
            font-size: 1.5em;
            color: #2e7d32;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
            max-width: 400px;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-input-display {
            border: 3px dashed #4caf50;
            border-radius: 15px;
            padding: 40px 20px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-input-display:hover {
            border-color: #2e7d32;
            background: #e8f5e8;
            transform: translateY(-2px);
        }

        .file-input-display.dragover {
            border-color: #2e7d32;
            background: #e8f5e8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            color: #4caf50;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9em;
        }

        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .detect-button {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .detect-button:hover {
            background: linear-gradient(135deg, #1b5e20, #2e7d32);
            transform: translateY(-2px);
        }

        .detect-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .detect-button.detecting::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 15px;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translateY(-50%);
        }

        @keyframes spin {
            to { transform: translateY(-50%) rotate(360deg); }
        }

        .detection-result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .detection-result.show {
            opacity: 1;
            transform: translateY(0);
        }

        .detection-result.anemic {
            background: #ffebee;
            color: #d32f2f;
            border: 2px solid #f44336;
        }

        .detection-result.non-anemic {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        /* Question Section */
        .question-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }

        .question-card.active {
            border-color: #4caf50;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-number {
            display: inline-block;
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 15px;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .option {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 70%);
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .option:hover {
            background: #e8f5e8;
            border-color: #4caf50;
            transform: translateY(-2px);
        }

        .option:hover::before {
            width: 100px;
            height: 100px;
        }

        .option.selected {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            border-color: #2e7d32;
            transform: translateY(-2px);
        }

        .option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .nav-button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .nav-button:hover::before {
            width: 100px;
            height: 100px;
        }

        .prev-button {
            background: #6c757d;
            color: white;
        }

        .prev-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .next-button {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
        }

        .next-button:hover {
            background: linear-gradient(135deg, #1b5e20, #2e7d32);
            transform: translateY(-2px);
        }

        .next-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .question-counter {
            color: #666;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }

        .result-card {
            background: linear-gradient(135deg, #e8f5e8, #f0f9f0);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 2px solid #4caf50;
        }

        .result-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 2em;
            color: #2e7d32;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .result-text {
            font-size: 1.1em;
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .recommendation {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #4caf50;
            text-align: left;
        }

        .recommendation h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .doctor-actions {
            margin-top: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 1px solid #ffeaa7;
        }

        .doctor-button {
            background: linear-gradient(135deg, #d32f2f, #f44336);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }

        .doctor-button:hover {
            background: linear-gradient(135deg, #b71c1c, #d32f2f);
            transform: translateY(-2px);
        }

        .back-button {
            background: #6c757d;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .back-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
                border-radius: 15px 15px 0 0;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .options {
                flex-direction: column;
            }
            
            .option {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="background-blobs">
        <div class="blob blob1"></div>
        <div class="blob blob2"></div>
        <div class="blob blob3"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üî¨ AI Medical Assessment</h1>
            <p id="headerText">Upload your eyelid image for anemia detection</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="content">
            <!-- Image Upload Section -->
            <div class="upload-section" id="uploadSection">
                <div class="upload-title">Step 1: Anemia Detection</div>
                <form class="upload-form" id="uploadForm">
                    <div class="file-input-wrapper">
                        <input type="file" id="eyelid" name="eyelid" accept="image/*" class="file-input" required>
                        <div class="file-input-display" id="fileInputDisplay">
                            <div class="upload-icon">üì∑</div>
                            <div class="upload-text">Click to upload eyelid image</div>
                            <div class="upload-subtext">or drag and drop your image here</div>
                        </div>
                    </div>
                    <img id="imagePreview" class="image-preview hidden" alt="Preview">
                    <button type="submit" class="detect-button" id="detectButton" disabled>
                        Analyze Image
                    </button>
                </form>
                <div class="detection-result" id="detectionResult"></div>
            </div>

            <!-- Questionnaire Section -->
            <div id="questionnaireSection" class="hidden">
                <div id="questionnaire">
                    <!-- Questions will be dynamically generated here -->
                </div>

                <div class="navigation">
                    <button class="nav-button prev-button" id="prevBtn" onclick="previousQuestion()">
                        ‚Üê Previous
                    </button>
                    <span class="question-counter" id="questionCounter">1 of 10</span>
                    <button class="nav-button next-button" id="nextBtn" onclick="nextQuestion()" disabled>
                        Next ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            "Are you currently experiencing a fever (temperature above 38¬∞C / 100.4¬∞F)?",
            "Do you have chills or experience shivering episodes?",
            "Have you been sweating excessively, especially after fever?",
            "Are you suffering from headaches?",
            "Do you feel nauseous or have you vomited recently?",
            "Are you experiencing fatigue or general body weakness?",
            "Do you have any muscle or joint pain?",
            "Have you noticed yellowing of the skin or eyes (jaundice)?",
            "Have you experienced any confusion or seizures recently?",
            "Have you recently traveled to or lived in a malaria-endemic area?"
        ];

        let currentQuestion = 0;
        let answers = {};
        let anemiaDetectionResult = null;

        // Image upload functionality
        const fileInput = document.getElementById('eyelid');
        const fileInputDisplay = document.getElementById('fileInputDisplay');
        const imagePreview = document.getElementById('imagePreview');
        const detectButton = document.getElementById('detectButton');
        const uploadForm = document.getElementById('uploadForm');

        fileInput.addEventListener('change', handleFileSelect);
        fileInputDisplay.addEventListener('dragover', handleDragOver);
        fileInputDisplay.addEventListener('drop', handleDrop);
        uploadForm.addEventListener('submit', handleImageUpload);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                displayImagePreview(file);
                detectButton.disabled = false;
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            fileInputDisplay.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            fileInputDisplay.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                displayImagePreview(files[0]);
                detectButton.disabled = false;
            }
        }

        function displayImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.classList.remove('hidden');
                
                // Update upload display
                fileInputDisplay.innerHTML = `
                    <div class="upload-icon">‚úÖ</div>
                    <div class="upload-text">Image selected: ${file.name}</div>
                    <div class="upload-subtext">Click to change image</div>
                `;
            };
            reader.readAsDataURL(file);
        }

        async function handleImageUpload(e) {
            e.preventDefault();

            if (!fileInput.files.length) {
                alert('Please select an image.');
                return;
            }

            const formData = new FormData();
            formData.append('eyelid', fileInput.files[0]);

            const detectButton = document.getElementById('detectButton');
            const detectionResult = document.getElementById('detectionResult');

            detectButton.textContent = 'Analyzing...';
            detectButton.classList.add('detecting');
            detectButton.disabled = true;

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                detectButton.classList.remove('detecting');
                detectButton.textContent = 'Analyze Image';

                if (data.error) {
                    detectionResult.textContent = 'Error: ' + data.error;
                    detectionResult.className = 'detection-result show';
                    detectionResult.style.background = '#ffebee';
                    detectionResult.style.color = '#d32f2f';
                    detectionResult.style.border = '2px solid #f44336';
                } else {
                    const confidence = Math.round(data.confidence * 100);
                    detectionResult.innerHTML = `
                        <div style="font-size: 1.5em; margin-bottom: 10px;">
                            ${data.prediction === 'Anemic' ? '‚ö†Ô∏è' : '‚úÖ'} ${data.prediction}
                        </div>
                        <div>Confidence: ${confidence}%</div>
                    `;
                    
                    detectionResult.className = `detection-result show ${data.prediction === 'Anemic' ? 'anemic' : 'non-anemic'}`;
                    
                    // Store detection result
                    anemiaDetectionResult = {
                        prediction: data.prediction,
                        confidence: data.confidence
                    };

                    // Show next step based on result
                    setTimeout(() => {
                        if (data.prediction === 'Anemic') {
                            proceedToSymptomAssessment();
                        } else {
                            showNonAnemicResult();
                        }
                    }, 2000);
                }
            } catch (err) {
                detectButton.classList.remove('detecting');
                detectButton.textContent = 'Analyze Image';
                detectionResult.textContent = 'Error during detection. Please try again.';
                detectionResult.className = 'detection-result show';
                detectionResult.style.background = '#ffebee';
                detectionResult.style.color = '#d32f2f';
                detectionResult.style.border = '2px solid #f44336';
                console.error('Detection error:', err);
            }
        }

        function proceedToSymptomAssessment() {
            // Update header
            document.getElementById('headerText').textContent = 'Anemia detected - Please complete symptom assessment';
            
            // Hide upload section
            document.getElementById('uploadSection').classList.add('hidden');
            
            // Show questionnaire section
            document.getElementById('questionnaireSection').classList.remove('hidden');
            
            // Initialize questionnaire
            initializeQuestionnaire();
            
            // Update progress bar
            updateProgressBar();
        }

        function showNonAnemicResult() {
            const questionnaire = document.getElementById('questionnaire');
            questionnaire.innerHTML = `
                <div class="result-card">
                    <div class="result-icon">‚úÖ</div>
                    <div class="result-title">No Anemia Detected</div>
                    <div class="result-text">
                        Great news! The AI analysis indicates no signs of anemia in your eyelid image. 
                        Your hemoglobin levels appear to be within normal range.
                    </div>
                    <div class="recommendation">
                        <h3>Recommendations:</h3>
                        <ul>
                            <li>Continue maintaining a healthy, iron-rich diet</li>
                            <li>Regular health check-ups are still important</li>
                            <li>Monitor for any symptoms and consult a doctor if concerned</li>
                            <li>Consider periodic screening as part of routine healthcare</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="back-button" onclick="window.location.href='/dashboard'">
                            ‚Üê Back to Dashboard
                        </button>
                        <button class="back-button" onclick="location.reload()">
                            üîÑ Test Again
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border: 1px solid #90caf9;">
                        <strong>Note:</strong> This AI screening is for preliminary assessment only. 
                        Always consult healthcare professionals for comprehensive medical evaluation.
                    </div>
                </div>
            `;
            
            // Update header and hide upload section
            document.getElementById('headerText').textContent = 'Assessment Complete';
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('questionnaireSection').classList.remove('hidden');
            
            // Hide navigation
            document.querySelector('.navigation').style.display = 'none';
            
            // Update progress bar to 100%
            document.getElementById('progressFill').style.width = '100%';
        }

        function initializeQuestionnaire() {
            const questionnaire = document.getElementById('questionnaire');
            
            questions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `question-${index}`;
                questionCard.style.animationDelay = `${index * 0.1}s`;
                
                if (index === 0) {
                    questionCard.classList.add('active');
                } else {
                    questionCard.classList.add('hidden');
                }

                questionCard.innerHTML = `
                    <div class="question-text">
                        <span class="question-number">${index + 1}</span>
                        ${question}
                    </div>
                    <div class="options">
                        <div class="option" onclick="selectOption(${index}, 'yes')">
                            Yes
                        </div>
                        <div class="option" onclick="selectOption(${index}, 'no')">
                            No
                        </div>
                    </div>
                `;
                
                questionnaire.appendChild(questionCard);
            });
            
            updateUI();
        }

        function selectOption(questionIndex, answer) {
            answers[questionIndex] = answer;
            
            // Update UI
            const questionCard = document.getElementById(`question-${questionIndex}`);
            const options = questionCard.querySelectorAll('.option');
            
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            const selectedOption = Array.from(options).find(option => 
                option.textContent.trim().toLowerCase() === answer
            );
            
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            updateUI();
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                // Hide current question
                document.getElementById(`question-${currentQuestion}`).classList.add('hidden');
                document.getElementById(`question-${currentQuestion}`).classList.remove('active');
                
                currentQuestion++;
                
                // Show next question
                const nextQuestionCard = document.getElementById(`question-${currentQuestion}`);
                nextQuestionCard.classList.remove('hidden');
                nextQuestionCard.classList.add('active');
                
                updateUI();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                // Hide current question
                document.getElementById(`question-${currentQuestion}`).classList.add('hidden');
                document.getElementById(`question-${currentQuestion}`).classList.remove('active');
                
                currentQuestion--;
                
                // Show previous question
                const prevQuestionCard = document.getElementById(`question-${currentQuestion}`);
                prevQuestionCard.classList.remove('hidden');
                prevQuestionCard.classList.add('active');
                
                updateUI();
            }
        }

        function updateUI() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const questionCounter = document.getElementById('questionCounter');
            
            // Update counter
            questionCounter.textContent = `${currentQuestion + 1} of ${questions.length}`;
            
            // Update progress bar (50% for image detection + 50% for questions)
            updateProgressBar();
            
            // Update buttons
            prevBtn.style.display = currentQuestion === 0 ? 'none' : 'inline-block';
            
            if (currentQuestion === questions.length - 1) {
                nextBtn.textContent = 'View Results';
                nextBtn.disabled = answers[currentQuestion] === undefined;
            } else {
                nextBtn.textContent = 'Next ‚Üí';
                nextBtn.disabled = answers[currentQuestion] === undefined;
            }
        }

        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            
            if (anemiaDetectionResult) {
                // 50% for detection complete + progress through questions
                const questionProgress = ((currentQuestion + 1) / questions.length) * 50;
                const totalProgress = 50 + questionProgress;
                progressFill.style.width = `${totalProgress}%`;
            } else {
                // Just image upload progress
                progressFill.style.width = '10%';
            }
        }

        function showResults() {
            const yesAnswers = Object.values(answers).filter(answer => answer === 'yes').length;
            const questionnaire = document.getElementById('questionnaire');
            
            let resultIcon, resultTitle, resultText, recommendation;
            
            if (yesAnswers >= 6) {
                resultIcon = 'üö®';
                resultTitle = 'High Risk Assessment';
                resultText = 'Based on your anemia detection and symptom responses, you have multiple indicators that could suggest malaria. Immediate medical attention is strongly recommended.';
                recommendation = `
                    <h3>üö® Immediate Actions Required:</h3>
                    <ul>
                        <li>Seek immediate medical attention at the nearest healthcare facility</li>
                        <li>Request a malaria rapid diagnostic test (RDT) or blood smear</li>
                        <li>Bring this assessment result to your healthcare provider</li>
                        <li>Do not delay treatment - early intervention is crucial</li>
                        <li>Monitor symptoms closely and call emergency services if condition worsens</li>
                    </ul>
                `;
            } else if (yesAnswers >= 3) {
                resultIcon = '‚ö†Ô∏è';
                resultTitle = 'Moderate Risk Assessment';
                resultText = 'You have several symptoms combined with anemia detection that warrant medical evaluation for possible malaria.';
                recommendation = `
                    <h3>‚ö†Ô∏è Recommended Actions:</h3>
                    <ul>
                        <li>Schedule an appointment with a healthcare provider within 24 hours</li>
                        <li>Request malaria testing (RDT or microscopy)</li>
                        <li>Monitor your symptoms and seek immediate care if they worsen</li>
                        <li>Stay hydrated and rest</li>
                        <li>Consider iron supplementation for anemia (consult doctor first)</li>
                    </ul>
                `;
            } else {
                resultIcon = 'üíõ';
                resultTitle = 'Lower Risk Assessment';
                resultText = 'While you have fewer typical malaria symptoms, the anemia detection still warrants medical evaluation and monitoring.';
                recommendation = `
                    <h3>üíõ Recommended Actions:</h3>
                    <ul>
                        <li>Consult with a healthcare provider about the anemia detection</li>
                        <li>Consider discussing malaria testing, especially if you've traveled to endemic areas</li>
                        <li>Continue monitoring for symptom development</li>
                        <li>Follow up on the anemia with appropriate treatment</li>
                        <li>Maintain a healthy, iron-rich diet</li>
                    </ul>
                `;
            }
            
            // Store comprehensive assessment data for sending to doctor
            const assessmentData = {
                timestamp: new Date().toISOString(),
                anemiaDetection: anemiaDetectionResult,
                symptoms: {},
                yesAnswers: yesAnswers,
                totalQuestions: questions.length,
                riskLevel: yesAnswers >= 6 ? 'High' : yesAnswers >= 3 ? 'Moderate' : 'Lower',
                resultText: resultText,
                prediction: anemiaDetectionResult.prediction,
                confidence: anemiaDetectionResult.confidence
            };

            // Map answers to symptom names
            const symptomMapping = [
                'fever', 'chills', 'sweating', 'headache', 'nausea', 
                'fatigue', 'pain', 'jaundice', 'seizure', 'travel'
            ];

            symptomMapping.forEach((symptom, index) => {
                assessmentData.symptoms[symptom] = answers[index] || 'no';
            });

            // Store in sessionStorage for the send-assessment page
            sessionStorage.setItem('assessmentData', JSON.stringify(assessmentData));
            
            questionnaire.innerHTML = `
                <div class="result-card">
                    <div class="result-icon">${resultIcon}</div>
                    <div class="result-title">${resultTitle}</div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #2e7d32;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">üìä Assessment Summary</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: left;">
                            <div>
                                <strong>Anemia Detection:</strong><br>
                                <span style="color: ${anemiaDetectionResult.prediction === 'Anemic' ? '#d32f2f' : '#2e7d32'};">
                                    ${anemiaDetectionResult.prediction}
                                </span>
                                <br><small>Confidence: ${Math.round(anemiaDetectionResult.confidence * 100)}%</small>
                            </div>
                            <div>
                                <strong>Symptom Score:</strong><br>
                                <span style="color: ${yesAnswers >= 6 ? '#d32f2f' : yesAnswers >= 3 ? '#f57c00' : '#2e7d32'};">
                                    ${yesAnswers}/${questions.length} symptoms
                                </span>
                                <br><small>Risk Level: ${assessmentData.riskLevel}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-text">${resultText}</div>
                    <div class="recommendation">${recommendation}</div>
                    
                    <div class="doctor-actions">
                        <h3 style="color: #2e7d32; margin-bottom: 15px;">üè• Medical Consultation Options</h3>
                        <p style="margin-bottom: 20px;">Would you like to send this comprehensive assessment to a healthcare provider for professional review?</p>
                        <a href="/send-assessment" class="doctor-button">
                            üì§ Send Assessment to Doctor
                        </a>
                        <button class="back-button" onclick="window.location.href='/dashboard'">
                            üè† Back to Dashboard
                        </button>
                        <button class="back-button" onclick="location.reload()">
                            üîÑ New Assessment
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
                        <strong>‚öïÔ∏è Important Medical Disclaimer:</strong> This AI-powered assessment is for screening and educational purposes only. It combines computer vision analysis with symptom evaluation but does not replace professional medical diagnosis. Always consult with qualified healthcare providers for proper diagnosis, treatment, and medical advice.
                    </div>
                </div>
            `;
            
            // Hide navigation and update header
            document.querySelector('.navigation').style.display = 'none';
            document.getElementById('headerText').textContent = 'Assessment Complete';
            
            // Set progress to 100%
            document.getElementById('progressFill').style.width = '100%';
        }

        // Initialize progress bar on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateProgressBar();
        });
    </script>
</body>
</html>